<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <title>Planificador de Viajes - NextStop</title>
    <link rel="stylesheet" href="./css/nav/nav.css">
    <link rel="stylesheet" href="./css/viajar/viajar.css">
</head>
<body>
    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Obteniendo tu ubicación...</div>
    </div>

    <div class="app-container">
        <!-- Header con patrón de puntos -->
        <div class="header-pattern"></div>

        <!-- Contenido principal -->
        <div class="main-content">
            <!-- Título principal -->
            <div class="header-title">
                <h1 class="page-title">Planifica tu Viaje</h1>
                <p class="page-subtitle">Inteligencia artificial para tu movilidad</p>
            </div>

            <!-- Sección de viajes recomendados -->
            <section class="section recommended-section" id="recommendedSection">
                <h2 class="section-title">
                    <svg class="title-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    Destinos Recomendados
                </h2>

                <div class="recommended-cards" id="recommendedCards">
                    <!-- Se llenarán dinámicamente -->
                </div>
            </section>

            <!-- Buscador por presupuesto -->
            <section class="section budget-section">
                <h2 class="section-title">
                    <svg class="title-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                    </svg>
                    ¿A dónde puedo ir?
                </h2>

                <div class="budget-input-container">
                    <div class="input-wrapper">
                        <span class="currency-symbol">C$</span>
                        <input type="number" id="budgetInput" class="budget-input" placeholder="Ingresa tu presupuesto" min="0" step="10">
                    </div>
                    <button class="budget-search-btn" id="budgetSearchBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        Buscar
                    </button>
                </div>

                <div class="budget-results" id="budgetResults">
                    <!-- Se llenarán dinámicamente -->
                </div>
            </section>

            <!-- Planificador de viaje -->
            <section class="section planner-section">
                <h2 class="section-title">
                    <svg class="title-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 6h-3V4c0-1.11-.89-2-2-2H9c-1.11 0-2 .89-2 2v2H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zM9 4h6v2H9V4zm11 15H4v-2h16v2zm0-5H4V8h3v1c0 .55.45 1 1 1s1-.45 1-1V8h6v1c0 .55.45 1 1 1s1-.45 1-1V8h3v6z"/>
                    </svg>
                    Planifica tu Ruta
                </h2>

                <button class="start-planning-btn" id="startPlanningBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    <span>Comenzar Planificación</span>
                </button>
            </section>
        </div>

        <!-- Modal de Planificación -->
        <div class="modal" id="planningModal">
            <div class="modal-overlay" id="modalOverlay"></div>
            <div class="modal-content-wrapper">
                <div class="modal-header">
                    <h3 class="modal-title">Planifica tu Viaje</h3>
                    <button class="modal-close" id="modalClose">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>

                <div class="modal-body">
                    <!-- Estado: Selección de destino -->
                    <div class="planning-state" id="stateSelectDestination">
                        <div class="location-detected">
                            <div class="location-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                                </svg>
                            </div>
                            <div class="location-info">
                                <span class="location-label">Tu ubicación actual</span>
                                <span class="location-address" id="currentLocation">Detectando...</span>
                            </div>
                        </div>

                        <div class="destination-selector">
                            <label class="input-label">Selecciona tu destino en el mapa</label>
                            <div id="planningMap" class="planning-map"></div>
                            <div class="destination-info" id="destinationInfo">
                                <span class="info-placeholder">Toca el mapa para seleccionar tu destino</span>
                            </div>
                        </div>

                        <button class="action-btn" id="calculateRouteBtn" disabled>
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                            </svg>
                            Calcular Ruta
                        </button>
                    </div>

                    <!-- Estado: Resultados del viaje -->
                    <div class="planning-state hidden" id="stateRouteResults">
                        <div class="route-map-container">
                            <div id="resultMap" class="result-map"></div>
                        </div>

                        <div class="route-summary">
                            <h4 class="summary-title">Resumen del Viaje</h4>

                            <div class="summary-cards">
                                <div class="summary-card">
                                    <div class="card-icon">
                                        <svg viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                                        </svg>
                                    </div>
                                    <div class="card-content">
                                        <span class="card-label">Tiempo estimado</span>
                                        <span class="card-value" id="travelTime">--</span>
                                    </div>
                                </div>

                                <div class="summary-card">
                                    <div class="card-icon">
                                        <svg viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                                        </svg>
                                    </div>
                                    <div class="card-content">
                                        <span class="card-label">Costo total</span>
                                        <span class="card-value" id="totalCost">--</span>
                                    </div>
                                </div>

                                <div class="summary-card">
                                    <div class="card-icon">
                                        <svg viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M4 16c0 .88.39 1.67 1 2.22V20c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h8v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4s-8 .5-8 4v10zm3.5 1c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm9 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm1.5-6H6V6h12v5z"/>
                                        </svg>
                                    </div>
                                    <div class="card-content">
                                        <span class="card-label">Transportes</span>
                                        <span class="card-value" id="busCount">--</span>
                                    </div>
                                </div>
                            </div>

                            <div class="route-steps" id="routeSteps">
                                <!-- Se llenarán dinámicamente -->
                            </div>
                        </div>

                        <button class="action-btn chatbot-btn" id="openChatBtn">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>
                            </svg>
                            Hacer una Pregunta
                        </button>

                        <button class="secondary-btn" id="newPlanningBtn">Nueva Planificación</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de detalles de destino -->
        <div class="modal" id="destinationModal">
            <div class="modal-overlay" id="destinationModalOverlay"></div>
            <div class="modal-content-wrapper modal-small">
                <div class="modal-header">
                    <h3 class="modal-title" id="destinationTitle">Destino</h3>
                    <button class="modal-close" id="destinationModalClose">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="destination-image" id="destinationImage"></div>
                    <div class="destination-details" id="destinationDetails">
                        <!-- Se llenará dinámicamente -->
                    </div>
                    <button class="action-btn" id="planToDestinationBtn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        Planificar Viaje
                    </button>
                </div>
            </div>
        </div>

        <!-- Chatbot Modal -->
        <div class="modal" id="chatModal">
            <div class="modal-overlay" id="chatModalOverlay"></div>
            <div class="modal-content-wrapper modal-chat">
                <div class="modal-header">
                    <h3 class="modal-title">
                        <svg class="title-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        Asistente de Viajes
                    </h3>
                    <button class="modal-close" id="chatModalClose">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="chat-container" id="chatContainer">
                        <div class="chat-message bot-message">
                            <div class="message-avatar">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>
                                </svg>
                            </div>
                            <div class="message-content">
                                <p>¡Hola! Soy tu asistente de viajes. Puedo ayudarte con información sobre tu ruta, costos, horarios y más. ¿En qué puedo ayudarte?</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chatInput" class="chat-input" placeholder="Escribe tu pregunta...">
                        <button class="chat-send-btn" id="chatSendBtn">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Barra de navegación inferior -->
        <div class="bottom-nav-container">
            <div class="navigation-container">
                <nav class="nav-bar">
                    <!-- Inicio -->
                    <div class="nav-item" data-nav="home" data-label="Home">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                        </svg>
                        <span class="nav-label">Inicio</span>
                    </div>

                    <!-- Ubicación -->
                    <div class="nav-item" data-nav="location" data-label="Location">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        <span class="nav-label">Mapa</span>
                    </div>

                    <!-- Persona caminando -->
                    <div class="nav-item active" data-nav="walk" data-label="Walk">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L8 8.5V13h2V9.6l-.2-.7z"/>
                        </svg>
                        <span class="nav-label">Viajar</span>
                    </div>

                    <!-- Bus -->
                    <div class="nav-item" data-nav="bus" data-label="Bus">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M4 16c0 .88.39 1.67 1 2.22V20c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h8v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1.78c.61-.55 1-1.34 1-2.22V6c0-3.5-3.58-4-8-4s-8 .5-8 4v10zm3.5 1c-.83 0-1.5-.67-1.5-1.5S6.67 14 7.5 14s1.5.67 1.5 1.5S8.33 17 7.5 17zm9 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm1.5-6H6V6h12v5z"/>
                        </svg>
                        <span class="nav-label">Buses</span>
                    </div>

                    <!-- Ajustes -->
                    <div class="nav-item" data-nav="settings" data-label="Settings">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm7-7H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-1.75 9c0 .23-.02.46-.05.68l1.48 1.16c.13.11.17.3.08.45l-1.4 2.42c-.09.15-.27.21-.43.15l-1.74-.7c-.36.28-.76.51-1.18.69l-.26 1.85c-.03.17-.18.3-.35.3h-2.8c-.17 0-.32-.13-.35-.29l-.26-1.85c-.43-.18-.82-.41-1.18-.69l-1.74.7c-.16.06-.34 0-.43-.15l-1.4-2.42c-.09-.15-.05-.34.08-.45l1.48-1.16c-.03-.23-.05-.46-.05-.69 0-.23.02-.46.05-.68l-1.48-1.16c-.13-.11-.17-.3-.08-.45l1.4-2.42c.09-.15.27-.21.43-.15l1.74.7c.36-.28.76-.51 1.18-.69l.26-1.85c.03-.17.18-.3.35-.3h2.8c.17 0 .32.13.35.29l.26 1.85c.43.18.82.41 1.18.69l1.74-.7c.16-.06.34 0 .43.15l1.4 2.42c.09.15.05.34-.08.45l-1.48 1.16c.03.23.05.46.05.69z"/>
                        </svg>
                        <span class="nav-label">Ajustes</span>
                    </div>
                </nav>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="./js/viajar/viajar.js"></script>
    <script src="./js/nav/navigation.js"></script>
    <script src="./js/nav/nav.js"></script>
</body>
</html>
